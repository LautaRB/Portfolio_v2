<div
  class="relative w-full h-full bg-neutral-900 rounded-3xl overflow-hidden border border-neutral-800"
>
  <div
    id="game-board"
    class="w-full h-full grid grid-cols-20 grid-rows-20 gap-px p-4 opacity-50"
  >
  </div>

  <div
    class="absolute inset-0 pointer-events-none bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-10 bg-size-[100%_2px,3px_100%]"
  >
  </div>

  <div class="absolute bottom-3 right-3 z-20">
    <span
      class="bg-neutral-950/80 text-green-400 text-[10px] font-mono px-2 py-1 rounded border border-green-900/50 animate-pulse"
    >
      AI_PLAYING...
    </span>
  </div>
</div>

<script>
  const COLS = 20;
  const ROWS = 20;
  const SPEED = 70;

  const board = document.getElementById('game-board');
  let cells: HTMLElement[] = [];

  let snake = [105, 104, 103, 102, 101, 100, 99, 98]; 
  let food = 55;
  let currentDir = 1; 
  
  if (board) {
    board.innerHTML = '';
    for (let i = 0; i < COLS * ROWS; i++) {
      const cell = document.createElement('div');
      cell.className = 'bg-neutral-800/20 rounded-sm border border-transparent box-border'; 
      board.appendChild(cell);
    }
    cells = Array.from(board.children) as HTMLElement[];
  }

  function draw() {
    cells.forEach(c => c.className = 'bg-neutral-800/20 rounded-sm border border-transparent');

    if (cells[food]) {
        cells[food].classList.remove('bg-neutral-800/20');
        cells[food].classList.add('bg-pink-500', 'rounded-full', 'shadow-[0_0_10px_rgba(236,72,153,0.8)]', 'scale-75');
    }

    snake.forEach((index, i) => {
      if (cells[index]) {
        cells[index].classList.remove('bg-neutral-800/20');
        const isHead = i === 0;
        const color = isHead ? 'bg-green-400' : 'bg-green-600';
        cells[index].classList.add(color);
      }
    });
  }

  function getCoords(index: number) {
    return { x: index % COLS, y: Math.floor(index / COLS) };
  }

  function getNextDirection() {
    const head = getCoords(snake[0]);
    const target = getCoords(food);
    let newDir = currentDir;

    if (head.x < target.x) newDir = 1;
    else if (head.x > target.x) newDir = -1;
    else if (head.y < target.y) newDir = COLS;
    else if (head.y > target.y) newDir = -COLS;
    
    if ((currentDir === 1 && newDir === -1) || 
        (currentDir === -1 && newDir === 1) || 
        (currentDir === COLS && newDir === -COLS) || 
        (currentDir === -COLS && newDir === COLS)) {
      return currentDir;
    }
    return newDir;
  }

  function gameLoop() {
    currentDir = getNextDirection();
    const head = snake[0];
    const newHead = head + currentDir;
    
    const hC = getCoords(head);
    const nHC = getCoords(newHead);
    const hitWallX = Math.abs(hC.x - nHC.x) > 1;
    const hitWallY = newHead < 0 || newHead >= COLS * ROWS;
    
    const hitBody = snake.includes(newHead);

    if (hitWallX || hitWallY || hitBody) {
      snake = [105, 104, 103, 102, 101, 100, 99, 98];
      currentDir = 1;
      food = Math.floor(Math.random() * (COLS * ROWS));
      draw();
      return;
    }

    snake.unshift(newHead);

    if (newHead === food) {
      do { food = Math.floor(Math.random() * (COLS * ROWS)); } 
      while (snake.includes(food));
    } else {
      snake.pop();
    }

    draw();
  }

  if (board && cells.length > 0) {
    draw(); 
    setInterval(gameLoop, SPEED);
  }
</script>
